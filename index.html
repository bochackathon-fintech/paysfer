<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>PaySfer</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- custom css -->
    <link rel="stylesheet" href="css/style.css">  
    
    <!-- font awesome -->
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css" />  
    
 	<!-- hints -->
	<link rel="stylesheet" href="css/hint.css"/>   
    
 	<!-- sweet alert -->
	<link rel="stylesheet" href="js/sweetalert2/sweetalert2.min.css" />	    
    
  </head>
  <body>
  <div class="container">
	  <div class="row">
                		<!-- account balance label -->
	                		<div class="col-md-6">
								<div class="alert alert-info text-center" id="accBalanceLabel">
									<h4>please, enter your account number to see your current balance</h4>
								</div> 	    								            	
	                		</div>	
							<div class="col-md-6">
								<div class="alert alert-success text-center" id="accEtherLabel">
									<h4>please, enter your account number to see your ether balance</h4>
								</div> 	    								            	
	                		</div>			
</div>
</div>
	<section id="customer_reg">
		<div class="container">
		<form id="signin" class="form-horizontal" role="form">	
			<div class="panel panel-info col-md-6 col-md-offset-3" id="reg-panel">
	            <div class="panel-heading text-center" id="panel-title">
	        	PaySfer
	            </div>
	            <div class="panel-body">
	                
	                	<div class="row">
	                		<!-- account number -->
	                		<div class="col-xs-6 col-md-offset-3">
	 							<div class="form-group">
									<label for="accNumber">Account Number<span class="asterisk"> *</span></label>
									<span class='hint--help hint--right hint--info hint--bounce hint--rounded hint--medium' data-hint="please enter your account number">
	 								<div class="input-group">
	  									<!-- icon -->
	 									<div class="input-group-addon">
											<span class="fa fa-map-marker blue"></span> 
	  									</div>					
											<input type="text" class="form-control" name="accNumber" id="accNumber" placeholder="please enter your account number">
									</div>						
									</span>
								</div>  
								<div class="alert alert-info text-center" id="accBalance" hidden>
  									<!--<strong><p></p></strong>-->
								</div> 
								<div class="alert alert-danger text-center" id="accBalanceError" hidden>
  									<!--<strong><p></p></strong>-->
								</div>      								    								            	
	                		</div>

							<!-- amount -->						
	                		<div class="col-xs-6 col-md-offset-3">
	 							<div class="form-group">
									<label for="amount">Deposit Amount<span class="asterisk"> *</span></label>
									<span class='hint--help hint--right hint--info hint--bounce hint--rounded hint--medium' data-hint="please enter the amount">
	 								<div class="input-group">
	  									<!-- icon -->
	 									<div class="input-group-addon">
											<span class="fa fa-map-marker blue"></span> 
	  									</div>					
											<input type="text" class="form-control" name="amount" id="amount" placeholder="please enter the amount">
									</div>						
									</span>
								</div>   
								<div class="alert alert-success text-center" id="accTransferOK" hidden>
  									<!--<strong><p></p></strong>-->
								</div>  
								<div class="alert alert-danger text-center" id="accTransferError" hidden>
  									<!--<strong><p></p></strong>-->
								</div>      								                    	
	                		</div>

							
							<!-- amount -->						
	                		<div class="col-xs-6 col-md-offset-3">
	 							<div class="form-group">
									<label for="amountCrypto">Amount of Crypto to transfer to seller<span class="asterisk"> *</span></label>
									<span class='hint--help hint--right hint--info hint--bounce hint--rounded hint--medium' data-hint="please enter the crypto amount">
	 								<div class="input-group">
	  									<!-- icon -->
	 									<div class="input-group-addon">
											<span class="fa fa-map-marker blue"></span> 
	  									</div>					
											<input type="text" class="form-control" name="amountCrypto" id="amountCrypto" placeholder="please enter the crypto amount">
									</div>						
									</span>
								</div>   			                    	
	                		</div>																						
	                	              			               		
	                	</div>	
	                	
	                
	            </div>
	            
	      		<div class="modal-footer">

					<button type="button" class="btn btn-lg btn-primary btn-block" name="btn-deposit-pool" id="btn-deposit-pool">
						<span class='hint--top hint--info hint--bounce hint--rounded' data-hint='add'><i class="fa fa-plus-square blue fa-bold"></i> Deposit to Pool</span>
					</button> 					

					<button type="button" class="btn btn-lg btn-primary btn-block" name="btn-trasfer-seller" id="btn-trasfer-seller">
						<span class='hint--top hint--info hint--bounce hint--rounded' data-hint='transfer'><i class="fa fa-plus-square blue fa-bold"></i> Transfer to Seller</span>
					</button> 	

					</div>
	      		</div>   
	         		                		
				</div>
			</form>				
		</div>
	</section>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    
	<!-- sweet alert js -->
	<script src="js/sweetalert2/sweetalert2.min.js"></script>	
	
	<!-- inline scripts related to this page -->
	--<script src="js/lef.js"></script>	    
    
    <script>
 	$(document).ready(function() {
 	$.ajaxSetup({ cache: false });
		//$('#btn-get-balance').on('click',function()
		// get account balance
		$('#accNumber').focusout(function()
		{ 	
			$.ajax({
				cache: false,
				url: "http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/accounts/b68e716c030d67ceb7e7a34f/5710bba5d42604e4072d1e92/account",
				beforeSend: function(xhrObj){
					xhrObj.setRequestHeader("Auth-Provider-Name", document.getElementById("accNumber").value.toString() ); //"055211011075");
					xhrObj.setRequestHeader("Auth-ID","123456789");
					xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","8da4cfbc226f472a9186fc9cf746e04c");
				},
				type: "GET",
				// Request body
				data: "{body}",
			})
			
			.done(function(data) {
				// show the balance in the alert
				$('#accBalance').html("<div class='alert alert-info'>"+'Your balance is ' + data.balance.amount +"</div>");
				$('#accBalance').show();
				$("#accBalance").slideUp(3000);
				$('#accBalanceLabel').html("<h4><div class='alert alert-info'>"+'Your balance is €' + data.balance.amount +"</div></h4>");
			})
			
			.fail(function() {
				// show the balance in the alert
				$('#accBalanceError').html("<div class='alert alert-danger'>"+'oops -- error getting balance ' +"</div>");
				$('#accBalanceError').show();
				$("#accBalanceError").slideUp(3000);
			});
		});

		$('#btn-deposit-pool').on('click',function()
		{
			//var x = document.getElementById("amount").value;

			$.ajax({
				cache: false,
					url: "http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/accounts/b68e716c030d67ceb7e7a34f/make-transaction",
					beforeSend: function(xhrObj){
						// Request headers
						xhrObj.setRequestHeader("Track-ID","4a9c41d5be483dd5bbbbaaaa");
						xhrObj.setRequestHeader("Auth-Provider-Name", document.getElementById("accNumber").value.toString());
						xhrObj.setRequestHeader("Auth-ID","123456789");
						xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","8da4cfbc226f472a9186fc9cf746e04c");
						xhrObj.setRequestHeader("Content-Type","application/json");
						//xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","{subscription key}");
					},
					type: "POST",
					// Request body
					data: '{"description": "EMVASMA 12 EUROS","challenge_type": "string","from": {"account_id": "b68e716c030d67ceb7e7a34f","bank_id": "bda8eb884efcef7082792d45"},"to": {"account_id": "556e140050aaa85e4a5b7429","bank_id": "bda8eb884efcef7082792d45"},"value": {"currency": "EUR","amount":'+ document.getElementById("amount").value +'}}',
					/*data: {"description": "test metafora","challenge_type": "string","from": {"account_id": "bda8eb884efcea209b2a6240","bank_id": "bda8eb884efcef7082792d45"},"to": {"account_id": "556e140050aaa85e4a5b7429","bank_id": "bda8eb884efcef7082792d45"},"value": {"currency": "EUR","amount": 12.00}},*/
				})
				.done(function(data) {

					$('#accTransferOK').html("<div class='alert alert-success'>"+'transferring ... please wait'+"</div>");
					$('#accTransferOK').show();
					$("#accTransferOK").fadeTo(2000, 500).slideUp(500, function()
					{
						//$("#accTransferOK").slideUp(3000);					
						swal({
							title: 'success',
							text: 'your balance is 200 ether',
							timer: 2000,
							type: 'success',
							showConfirmButton: false
						})
					});
					
					setTimeout( getNewBalance, 3000);	

				})
				.fail(function() {
					$('#accTransferError').html("<div class='alert alert-error'>"+'oops --- transfer error'+"</div>");
					$('#accTransferError').show();
					$("#accTransferError").slideUp(3000);					
				});



	 	});
	});	

		$('#btn-transfer-seller').on('click',function()
		{
			//var x = document.getElementById("amount").value;

			$.ajax({
				cache: false,
					url: "http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/accounts/b68e716c030d67ceb7e7a34f/make-transaction",
					beforeSend: function(xhrObj){
						// Request headers
						xhrObj.setRequestHeader("Track-ID","4a9c41d5be483dd5bbbbaaaa");
						xhrObj.setRequestHeader("Auth-Provider-Name", document.getElementById("accNumber").value.toString());
						xhrObj.setRequestHeader("Auth-ID","123456789");
						xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","8da4cfbc226f472a9186fc9cf746e04c");
						xhrObj.setRequestHeader("Content-Type","application/json");
						//xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","{subscription key}");
					},
					type: "POST",
					// Request body 
					data: '{"description": "EMVASMA 12 EUROS","challenge_type": "string","from": {"account_id": "b68e716c030d67ceb7e7a34f","bank_id": "bda8eb884efcef7082792d45"},"to": {"account_id": "556e140050aaa85e4a5b7429","bank_id": "bda8eb884efcef7082792d45"},"value": {"currency": "EUR","amount":'+ document.getElementById("amount").value +'}}',
					/*data: {"description": "test metafora","challenge_type": "string","from": {"account_id": "bda8eb884efcea209b2a6240","bank_id": "bda8eb884efcef7082792d45"},"to": {"account_id": "556e140050aaa85e4a5b7429","bank_id": "bda8eb884efcef7082792d45"},"value": {"currency": "EUR","amount": 12.00}},*/
				})
				.done(function(data) {

					$('#accTransferOK').html("<div class='alert alert-success'>"+'transferring ... please wait'+"</div>");
					$('#accTransferOK').show();
					$("#accTransferOK").fadeTo(2000, 500).slideUp(500, function()
					{
						//$("#accTransferOK").slideUp(3000);					
						swal({
							title: 'success',
							text: 'your balance is 200 ether',
							timer: 2000,
							type: 'success',
							showConfirmButton: false
						})
					});
					
					setTimeout( getNewBalance, 3000);	

				})
				.fail(function() {
					$('#accTransferError').html("<div class='alert alert-error'>"+'oops --- transfer error'+"</div>");
					$('#accTransferError').show();
					$("#accTransferError").slideUp(3000);					
				});



	 	});
	});	

function getNewBalance()
{


	// get new balance
	$.ajax({
		cache: false,
		url: "http://api.bocapi.net/v1/api/banks/bda8eb884efcef7082792d45/accounts/b68e716c030d67ceb7e7a34f/5710bba5d42604e4072d1e92/account",
		beforeSend: function(xhrObj){
			xhrObj.setRequestHeader("Auth-Provider-Name", document.getElementById("accNumber").value.toString() ); //"055211011075");
			xhrObj.setRequestHeader("Auth-ID","123456789");
			xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","8da4cfbc226f472a9186fc9cf746e04c");
		},
		type: "GET",
		"dataType":"json"
	})
	
	.done(function(data2) {
		// show the new balance in the alert
		$('#accBalanceLabel').html("<h4><div class='alert alert-info'>"+'Your balance is €' + data2.balance.amount +"</div></h4>");
	})
	
	.fail(function() {
		// show the balance in the alert
		$('#accBalanceLabel').html("<div class='alert alert-danger'>"+'oops -- error getting balance ' +"</div>");
	});


}	
    </script>
    
    
  </body>
</html>